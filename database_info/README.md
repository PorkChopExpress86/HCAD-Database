# Database Info Directory

This directory contains extracted and processed metadata from HCAD's data documentation PDFs.

## Primary Output Files

### Structured Codebook Data
- **`pdataCodebook_structured.json`** — Master structured output containing all 67 tables with their 5-column field definitions (Column Name, Data Type, Size, Allow Null, Description). Generated by `parse_codebook_full3.py`.
- **`codebook_tables/`** — Directory containing 67 individual CSV files (one per table), each with the 5-column structure for easy reference.

### Source Documentation
- **`pdataCodebook.pdf`** — Original HCAD codebook PDF (source for all structured data).
- **`pdataCodebook.txt`** — Plain text extraction of the codebook PDF (used during initial exploration).
- **`Definition_help.pdf`** / **`Definition_help.txt`** — HCAD field definition guide.
- **`GIS-ReadMeV2.pdf`** / **`GIS-ReadMeV2.txt`** — GIS data documentation.
- **`Import_Instructions.pdf`** / **`Import_Instructions.txt`** — Import instructions for HCAD data.

## Processing Script

**`parse_codebook_full.py`** — The canonical parser script that generates all structured output.

### Usage
```powershell
& ".venv\Scripts\python.exe" database_info/parse_codebook_full3.py
```

### Output
- Writes `pdataCodebook_structured.json` (master JSON with all 67 tables)
- Writes `codebook_tables/*_columns.csv` (67 individual CSV files)

### How It Works
1. Uses `pdfplumber` to extract words with coordinates from `pdataCodebook.pdf`
2. Groups words into lines based on vertical position (y-coordinate)
3. Detects column boundaries from the header row (Column Name, Data Type, Size, Allow Null, Description)
4. Assigns each word to its nearest column based on x-coordinate
5. Segments tables by "Text file:" markers
6. Merges wrapped description lines into the primary field description
7. Outputs structured JSON and per-table CSVs

## Key File Structures

### pdataCodebook_structured.json
```json
{
  "tables": [
    {
      "file": "arb_hearings_pp.txt",
      "page_start": 3,
      "fields": [
        {
          "name": "acct",
          "data_type": "varchar",
          "size": "7",
          "allow_null": "NO",
          "description": "Account Number",
          "page": 3
        },
        ...
      ]
    },
    ...
  ]
}
```

### codebook_tables/*.csv Format
```csv
Column Name,Data Type,Size,Allow Null,Description,Source Page
acct,varchar,7,NO,Account Number,3
Tax_Year,varchar,4,,ARB Hearing Tax Year,3
...
```

## Notes

- All intermediate development artifacts have been cleaned up.
- The `codebook/` directory is reserved for future use or additional documentation.
- To regenerate the structured output, simply run `parse_codebook_full3.py` again (it will overwrite existing output files).
- Empty "Allow Null" cells indicate the PDF did not specify a constraint for that field.
- Multi-line descriptions (such as format notes or code reference lines) are concatenated with spaces.

## Maintenance

If you need to update or modify the parsing logic:
1. Edit `parse_codebook_full3.py`
2. Run the script to regenerate output
3. Verify sample tables in `codebook_tables/` against the source PDF

For questions or issues with the codebook structure, refer to the original `pdataCodebook.pdf`.
